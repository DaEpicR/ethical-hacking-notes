# Lab Setup

* Following components are required for lab setup:

  * VirtualBox
  * Windows 10 VM - FLARE-VM to be installed on it
  * REMnux VM

* Do not forget to take regular snapshots of VM.

* Tweaks in Windows 10 VM before installing FLARE-VM:

  ```ps
  cd Desktop

  wget https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx -usebasicparsing -o VCLibs.appx
  # download VCLibs package

  wget https://github.com/microsoft/terminal/releases/download/v1.15.3465.0/Microsoft.WindowsTerminal_Win10_1.15.3465.0_8wekyb3d8bbwe.msixbundle -UseBasicParsing -o winterminal.msixbundle
  # download Windows Terminal

  Add-AppxPackage .\VCLibs.appx
  # install VCLibs

  Add-AppxPackage .\winterminal.msixbundle
  # install Windows Terminal
  ```

  * Proxy settings > Disable 'Automatically detect settings'

  * Disable all settings on Windows Security

  * Group Policy > Local Computer Policy > Computer Configuration > Administrative Templates > Windows Components > Microsoft Defender Antivirus > Turn off Microsoft Defender Antivirus > change state to 'Enabled'

  * Group Policy > Local Computer Policy > Computer Configuration > Administrative Templates > Network > Network Connections > Windows Defender Firewall > both for Domain Profile & Standard Profile > change state to 'Disabled' for 'Protect all Network Connections'

  * Run Windows Terminal as Administrator:

    ```ps
    (New-Object net.webclient).DownloadFile('https://raw.githubusercontent.com/mandiant/flare-vm/main/install.ps1',"$([Environment]::GetFolderPath("Desktop"))\install.ps1")
    # download flarevm installer

    cd .\Desktop\

    Unblock-File .\install.ps1

    Set-ExecutionPolicy Unrestricted

    .\install.ps1 -customConfig https://raw.githubusercontent.com/HuskyHacks/PMAT-labs/main/config.xml
    # this will take some time
    ```

  * Take a snapshot after config

* Network setup:

  * Virtualbox > Tools > Network > Create > Configure adapter manually with IP ```10.0.0.1/24``` > Enable DHCP server with address ```10.0.0.2/24``` and range ```10.0.0.3 - 10.0.0.254``` > Apply changes for both

  * Virtualbox > PMAT-FlareVM (do the same for Remnux VM too) > Settings > Network > select 'Attached to' as 'Host-only Adapter' & in name, select the newly set adapter > other adapters should not be enabled > Apply changes

  * Start both VMs and check if the settings have been applied > ```ip a``` on Remnux and ```ipconfig``` on Windows (Commander can be launched using 'cmder') > do a ping test between the 2 VMs as well

* Setup ```INetSim``` on Remnux:

  ```shell
  inetsim
  # used to launch the service

  sudo nano /etc/inetsim/inetsim.conf
  # uncomment 'start_service dns' line
  # modify IP for service_bind_address as 0.0.0.0 - to bind to all interfaces on host
  # modify dns_default_ip as remnux ip - 10.0.0.3
  # save changes

  inetsim
  # confirm changes
  # can test this by navigating to 10.0.0.3 on Flare-VM
  ```

* Update DNS server settings - Flare-VM > view network connections > Ethernet > Properties > IPv4 properties > Add DNS server address of 10.0.0.3

* Flare-VM setup for host-based indicators & Remnux setup for network-based indicators, w.r.t. malware analysis.

* [Lab Repo](https://github.com/HuskyHacks/PMAT-labs)

* Malware resources:

  * [theZoo](https://github.com/ytisf/theZoo)
  * [vx-underground site](https://www.vx-underground.org/)
  * [vx-underground repo](https://github.com/vxunderground/MalwareSourceCode)
  * [Zeltser](https://zeltser.com/malware-sample-sources/)
  * [MalwareBazaar](https://bazaar.abuse.ch/)
